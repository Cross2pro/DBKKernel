# DBKé©±åŠ¨ - Socketé€šä¿¡ä½¿ç”¨æŒ‡å—ï¼ˆä¸­æ–‡ç‰ˆï¼‰

## ğŸ¯ é¡¹ç›®ç®€ä»‹

è¿™æ˜¯ä¸€ä¸ª**çº¯Socketé€šä¿¡**çš„Windowså†…æ ¸é©±åŠ¨ï¼Œå®Œå…¨ç§»é™¤äº†ä¼ ç»Ÿçš„IRPé€šä¿¡æ–¹å¼ã€‚

**æ ¸å¿ƒç‰¹ç‚¹ï¼š**
- âœ… ä¸åˆ›å»ºè®¾å¤‡å¯¹è±¡ï¼Œä¸ä½¿ç”¨DeviceIoControl
- âœ… é€šè¿‡TCP Socketä¸ç”¨æˆ·æ€é€šä¿¡ï¼ˆç«¯å£28996ï¼‰
- âœ… æ”¯æŒä»»ä½•ç¼–ç¨‹è¯­è¨€ï¼ˆPythonã€C++ã€C#ã€Javaç­‰ï¼‰
- âœ… ä¿ç•™æ‰€æœ‰åŸæœ‰å†…æ ¸åŠŸèƒ½ï¼ˆå†…å­˜è¯»å†™ã€è¿›ç¨‹æ“ä½œç­‰ï¼‰

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¬¬ä¸€æ­¥ï¼šç¼–è¯‘é©±åŠ¨

```cmd
# æ‰“å¼€WDKå‘½ä»¤æç¤ºç¬¦
cd C:\Users\RED\Desktop\Lee\DBKKernel

# ç¼–è¯‘x64ç‰ˆæœ¬
msbuild DBK.sln /p:Configuration=Release /p:Platform=x64
```

**æ³¨æ„äº‹é¡¹ï¼š**
- éœ€è¦å®‰è£…Windows Driver Kit (WDK)
- éœ€è¦åœ¨é¡¹ç›®ä¸­æ·»åŠ  `netio.lib` é“¾æ¥åº“
- ç¡®ä¿ `SocketComm.c` å’Œ `SocketComm.h` å·²æ·»åŠ åˆ°é¡¹ç›®

### ç¬¬äºŒæ­¥ï¼šåŠ è½½é©±åŠ¨

```cmd
# ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œå‘½ä»¤æç¤ºç¬¦

# åˆ›å»ºé©±åŠ¨æœåŠ¡
sc create DBK type= kernel binPath= C:\path\to\DBK.sys

# å¯åŠ¨é©±åŠ¨
sc start DBK
```

**æµ‹è¯•ç¯å¢ƒè®¾ç½®ï¼š**
```cmd
# ç¦ç”¨é©±åŠ¨ç­¾åå¼ºåˆ¶ï¼ˆä»…æµ‹è¯•ç¯å¢ƒï¼‰
bcdedit /set testsigning on
# é‡å¯ç”µè„‘
```

### ç¬¬ä¸‰æ­¥ï¼šéªŒè¯é©±åŠ¨

```cmd
# æ£€æŸ¥é©±åŠ¨çŠ¶æ€
sc query DBK

# æ£€æŸ¥ç«¯å£ç›‘å¬
netstat -ano | findstr 28996
```

**é¢„æœŸè¾“å‡ºï¼š**
```
TCP    127.0.0.1:28996        0.0.0.0:0              LISTENING
```

### ç¬¬å››æ­¥ï¼šè¿è¡Œå®¢æˆ·ç«¯

**Pythonå®¢æˆ·ç«¯ï¼š**
```bash
python SocketClient.py
```

**C++å®¢æˆ·ç«¯ï¼š**
```cmd
# ç¼–è¯‘
cl SocketClient.cpp /link ws2_32.lib

# è¿è¡Œ
SocketClient.exe
```

## ğŸ“¡ é€šä¿¡åè®®

### è¿æ¥ä¿¡æ¯

- **åœ°å€**: `127.0.0.1`ï¼ˆä»…æœ¬åœ°ï¼‰
- **ç«¯å£**: `28996`
- **åè®®**: TCP

### æ¶ˆæ¯æ ¼å¼

**è¯·æ±‚æ¶ˆæ¯ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ¶ˆæ¯å¤´ (16å­—èŠ‚)             â”‚
â”‚ - IOCTLä»£ç  (4å­—èŠ‚)         â”‚
â”‚ - è¾“å…¥å¤§å° (4å­—èŠ‚)          â”‚
â”‚ - è¾“å‡ºå¤§å° (4å­—èŠ‚)          â”‚
â”‚ - ä¿ç•™å­—æ®µ (4å­—èŠ‚)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è¾“å…¥æ•°æ® (å˜é•¿)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å“åº”æ¶ˆæ¯ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å“åº”å¤´ (16å­—èŠ‚)             â”‚
â”‚ - çŠ¶æ€ç  (4å­—èŠ‚)            â”‚
â”‚ - æ•°æ®å¤§å° (4å­—èŠ‚)          â”‚
â”‚ - ä¿ç•™å­—æ®µ1 (4å­—èŠ‚)         â”‚
â”‚ - ä¿ç•™å­—æ®µ2 (4å­—èŠ‚)         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è¾“å‡ºæ•°æ® (å˜é•¿)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ’» Pythonä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€ä½¿ç”¨

```python
from SocketClient import DBKSocketClient

# åˆ›å»ºå®¢æˆ·ç«¯
client = DBKSocketClient()

# è¿æ¥åˆ°é©±åŠ¨
client.connect()

# è·å–é©±åŠ¨ç‰ˆæœ¬
version = client.get_version()
print(f"é©±åŠ¨ç‰ˆæœ¬: {version}")

# æ–­å¼€è¿æ¥
client.disconnect()
```

### è¿›ç¨‹æ“ä½œ

```python
# æ‰“å¼€è¿›ç¨‹
process_id = 1234
handle = client.open_process(process_id)
print(f"è¿›ç¨‹å¥æŸ„: 0x{handle:016X}")

# è·å–EPROCESSåœ°å€
peprocess = client.get_peprocess(process_id)
print(f"EPROCESS: 0x{peprocess:016X}")
```

### å†…å­˜æ“ä½œ

```python
# è¯»å–å†…å­˜
address = 0x400000
size = 64
data = client.read_process_memory(process_id, address, size)
print(f"è¯»å–äº† {len(data)} å­—èŠ‚")

# å†™å…¥å†…å­˜
new_data = b"\x90" * 10  # NOPæŒ‡ä»¤
client.write_process_memory(process_id, address, new_data)
print("å†™å…¥æˆåŠŸ")
```

### å®Œæ•´ç¤ºä¾‹

```python
from SocketClient import DBKSocketClient
import os

# åˆ›å»ºå®¢æˆ·ç«¯
client = DBKSocketClient()

try:
    # è¿æ¥
    client.connect()
    print("[+] å·²è¿æ¥åˆ°é©±åŠ¨")
    
    # è·å–å½“å‰è¿›ç¨‹ID
    pid = os.getpid()
    print(f"[*] å½“å‰è¿›ç¨‹PID: {pid}")
    
    # æ‰“å¼€è¿›ç¨‹
    handle = client.open_process(pid)
    print(f"[+] è¿›ç¨‹å¥æŸ„: 0x{handle:016X}")
    
    # è¯»å–å†…å­˜
    data = client.read_process_memory(pid, 0x400000, 64)
    print(f"[+] è¯»å–äº† {len(data)} å­—èŠ‚")
    
    # æ‰“å°åå…­è¿›åˆ¶
    for i in range(0, len(data), 16):
        hex_str = " ".join(f"{b:02X}" for b in data[i:i+16])
        print(f"  {i:04X}: {hex_str}")
    
except Exception as e:
    print(f"[-] é”™è¯¯: {e}")
    
finally:
    # æ–­å¼€è¿æ¥
    client.disconnect()
    print("[+] å·²æ–­å¼€è¿æ¥")
```

## ğŸ’» C++ä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€ä½¿ç”¨

```cpp
#include "SocketClient.cpp"

int main() {
    DBKSocketClient client;
    
    // è¿æ¥åˆ°é©±åŠ¨
    if (!client.Connect()) {
        printf("[-] è¿æ¥å¤±è´¥\n");
        return 1;
    }
    printf("[+] å·²è¿æ¥åˆ°é©±åŠ¨\n");
    
    // è·å–é©±åŠ¨ç‰ˆæœ¬
    ULONG version;
    if (client.GetVersion(&version)) {
        printf("[+] é©±åŠ¨ç‰ˆæœ¬: %u\n", version);
    }
    
    // æ–­å¼€è¿æ¥
    client.Disconnect();
    printf("[+] å·²æ–­å¼€è¿æ¥\n");
    
    return 0;
}
```

### è¿›ç¨‹å’Œå†…å­˜æ“ä½œ

```cpp
// æ‰“å¼€è¿›ç¨‹
DWORD pid = 1234;
UINT64 handle;
if (client.OpenProcess(pid, &handle)) {
    printf("[+] è¿›ç¨‹å¥æŸ„: 0x%016llX\n", handle);
}

// è¯»å–å†…å­˜
BYTE buffer[64];
if (client.ReadProcessMemory(pid, 0x400000, 64, buffer)) {
    printf("[+] è¯»å–äº† 64 å­—èŠ‚\n");
    
    // æ‰“å°åå…­è¿›åˆ¶
    for (int i = 0; i < 64; i += 16) {
        printf("  %04X: ", i);
        for (int j = 0; j < 16 && i + j < 64; j++) {
            printf("%02X ", buffer[i + j]);
        }
        printf("\n");
    }
}

// è·å–EPROCESS
UINT64 peprocess;
if (client.GetPEProcess(pid, &peprocess)) {
    printf("[+] EPROCESS: 0x%016llX\n", peprocess);
}
```

## ğŸ”§ æ”¯æŒçš„åŠŸèƒ½

### å¸¸ç”¨IOCTLå‘½ä»¤

| åŠŸèƒ½ | IOCTLä»£ç  | è¯´æ˜ |
|------|-----------|------|
| è·å–ç‰ˆæœ¬ | 0x9C4020C0 | è·å–é©±åŠ¨ç‰ˆæœ¬å· |
| æ‰“å¼€è¿›ç¨‹ | 0x9C402008 | è·å–è¿›ç¨‹å¥æŸ„ |
| æ‰“å¼€çº¿ç¨‹ | 0x9C40200C | è·å–çº¿ç¨‹å¥æŸ„ |
| è¯»å–å†…å­˜ | 0x9C402000 | è¯»å–è¿›ç¨‹å†…å­˜ |
| å†™å…¥å†…å­˜ | 0x9C402004 | å†™å…¥è¿›ç¨‹å†…å­˜ |
| è·å–EPROCESS | 0x9C402034 | è·å–è¿›ç¨‹å†…æ ¸ç»“æ„ |
| è¯»å–ç‰©ç†å†…å­˜ | 0x9C402038 | è¯»å–ç‰©ç†å†…å­˜ |

**å®Œæ•´åˆ—è¡¨**: æ‰€æœ‰åŸæœ‰çš„IOCTLå‘½ä»¤éƒ½è¢«ä¿ç•™ï¼Œè¯¦è§ `IOPLDispatcher.c`

## ğŸ” æ•…éšœæ’é™¤

### é—®é¢˜1: é©±åŠ¨åŠ è½½å¤±è´¥

**ç—‡çŠ¶**: `sc start DBK` è¿”å›é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:
```cmd
# 1. ç¦ç”¨é©±åŠ¨ç­¾åå¼ºåˆ¶
bcdedit /set testsigning on
# é‡å¯ç”µè„‘

# 2. æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—
eventvwr.msc
# æŸ¥çœ‹ Windowsæ—¥å¿— â†’ ç³»ç»Ÿ
```

### é—®é¢˜2: å®¢æˆ·ç«¯æ— æ³•è¿æ¥

**ç—‡çŠ¶**: `è¿æ¥å¤±è´¥: 10061`

**è§£å†³æ–¹æ¡ˆ**:
```cmd
# 1. æ£€æŸ¥é©±åŠ¨çŠ¶æ€
sc query DBK

# 2. æ£€æŸ¥ç«¯å£ç›‘å¬
netstat -ano | findstr 28996

# 3. æŸ¥çœ‹é©±åŠ¨æ—¥å¿—
# ä¸‹è½½å¹¶è¿è¡Œ DebugView
# https://docs.microsoft.com/sysinternals
```

### é—®é¢˜3: ç¼–è¯‘é”™è¯¯

**ç—‡çŠ¶**: `æ— æ³•è§£æçš„å¤–éƒ¨ç¬¦å· WskRegister`

**è§£å†³æ–¹æ¡ˆ**:
1. æ‰“å¼€é¡¹ç›®å±æ€§
2. é“¾æ¥å™¨ â†’ è¾“å…¥ â†’ é™„åŠ ä¾èµ–é¡¹
3. æ·»åŠ  `netio.lib`

### é—®é¢˜4: æŸ¥çœ‹é©±åŠ¨æ—¥å¿—

**ä½¿ç”¨DebugViewæŸ¥çœ‹æ—¥å¿—**:
```cmd
# 1. ä¸‹è½½DebugView
# https://docs.microsoft.com/sysinternals

# 2. ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ
Dbgview.exe

# 3. å¯ç”¨å†…æ ¸æ¶ˆæ¯æ•è·
# Capture â†’ Capture Kernel

# 4. æŸ¥æ‰¾ä»¥ä¸‹æ—¥å¿—
[SocketComm] Initializing socket communication...
[SocketComm] Socket listener started on port 28996
[SocketComm] Client connected from 127.0.0.1:xxxxx
```

## ğŸ“Š æ€§èƒ½å‚è€ƒ

### å»¶è¿Ÿæ•°æ®

| æ“ä½œ | å¹³å‡å»¶è¿Ÿ |
|------|---------|
| è·å–ç‰ˆæœ¬ | ~0.35ms |
| æ‰“å¼€è¿›ç¨‹ | ~0.40ms |
| è¯»å–64å­—èŠ‚ | ~0.45ms |
| è¯»å–4KB | ~0.80ms |

### ååé‡

- **æ¯ç§’æ“ä½œæ•°**: ~2,222 ops/s
- **é€‚ç”¨åœºæ™¯**: ä¸­ä½é¢‘è°ƒç”¨ï¼ˆ<1000æ¬¡/ç§’ï¼‰

## ğŸ”’ å®‰å…¨æ³¨æ„äº‹é¡¹

### å½“å‰å®‰å…¨æªæ–½

1. âœ… **ä»…æœ¬åœ°è®¿é—®** - åªç›‘å¬127.0.0.1
2. âœ… **å•å®¢æˆ·ç«¯** - åŒæ—¶åªå…è®¸ä¸€ä¸ªè¿æ¥
3. âœ… **è¾“å…¥éªŒè¯** - æ£€æŸ¥ç¼“å†²åŒºå¤§å°
4. âœ… **ç®¡ç†å‘˜æƒé™** - éœ€è¦ç®¡ç†å‘˜æƒé™åŠ è½½

### å®‰å…¨å»ºè®®

1. ğŸ”’ ä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒæš´éœ²ç«¯å£
2. ğŸ”’ ä½¿ç”¨é˜²ç«å¢™é™åˆ¶è®¿é—®
3. ğŸ”’ å®šæœŸæ£€æŸ¥é©±åŠ¨æ—¥å¿—
4. ğŸ”’ åŠæ—¶æ›´æ–°é©±åŠ¨ç‰ˆæœ¬

## ğŸ“š ç›¸å…³æ–‡æ¡£

| æ–‡æ¡£ | è¯´æ˜ |
|------|------|
| [README.md](README.md) | é¡¹ç›®ä¸»é¡µ |
| [SOCKET_COMMUNICATION_GUIDE.md](SOCKET_COMMUNICATION_GUIDE.md) | è¯¦ç»†æŠ€æœ¯æ–‡æ¡£ |
| [QUICKSTART.md](QUICKSTART.md) | å¿«é€Ÿå¼€å§‹æŒ‡å— |
| [IRP_vs_SOCKET.md](IRP_vs_SOCKET.md) | IRPä¸Socketå¯¹æ¯” |

## ğŸ“ å­¦ä¹ èµ„æº

### æ¨èé˜…è¯»é¡ºåº

1. **README.md** - äº†è§£é¡¹ç›®æ¦‚å†µ
2. **æœ¬æ–‡æ¡£** - å­¦ä¹ åŸºæœ¬ä½¿ç”¨
3. **SOCKET_COMMUNICATION_GUIDE.md** - æ·±å…¥ç†è§£åè®®
4. **å®¢æˆ·ç«¯æºç ** - å­¦ä¹ å®ç°ç»†èŠ‚

### ç¤ºä¾‹ä»£ç ä½ç½®

- Pythonå®¢æˆ·ç«¯: `SocketClient.py`
- C++å®¢æˆ·ç«¯: `SocketClient.cpp`
- é©±åŠ¨æºç : `DBK/SocketComm.c`

## ğŸ’¡ ä½¿ç”¨æŠ€å·§

### æŠ€å·§1: ä¿æŒé•¿è¿æ¥

```python
# å¥½çš„åšæ³• - å¤ç”¨è¿æ¥
client = DBKSocketClient()
client.connect()

for i in range(1000):
    client.get_version()  # å¤ç”¨åŒä¸€ä¸ªè¿æ¥

client.disconnect()

# ä¸å¥½çš„åšæ³• - é¢‘ç¹è¿æ¥
for i in range(1000):
    client = DBKSocketClient()
    client.connect()
    client.get_version()
    client.disconnect()  # æ¯æ¬¡éƒ½é‡æ–°è¿æ¥ï¼Œå¾ˆæ…¢
```

### æŠ€å·§2: æ‰¹é‡è¯»å–

```python
# å¥½çš„åšæ³• - ä¸€æ¬¡è¯»å–å¤§å—
data = client.read_process_memory(pid, 0x400000, 0x10000)  # 64KB

# ä¸å¥½çš„åšæ³• - å¤šæ¬¡å°è¯»å–
for addr in range(0x400000, 0x410000, 0x1000):
    data = client.read_process_memory(pid, addr, 0x1000)  # 4KB * 16æ¬¡
```

### æŠ€å·§3: é”™è¯¯å¤„ç†

```python
try:
    client.connect()
    data = client.read_process_memory(pid, address, size)
except ConnectionError:
    print("è¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥é©±åŠ¨æ˜¯å¦è¿è¡Œ")
except Exception as e:
    print(f"å‘ç”Ÿé”™è¯¯: {e}")
finally:
    client.disconnect()
```

## ğŸ†˜ è·å–å¸®åŠ©

### é‡åˆ°é—®é¢˜ï¼Ÿ

1. **æŸ¥çœ‹æ–‡æ¡£** - é¦–å…ˆé˜…è¯»ç›¸å…³æ–‡æ¡£
2. **æŸ¥çœ‹æ—¥å¿—** - ä½¿ç”¨DebugViewæŸ¥çœ‹é©±åŠ¨æ—¥å¿—
3. **æ£€æŸ¥ç¤ºä¾‹** - å‚è€ƒå®¢æˆ·ç«¯ç¤ºä¾‹ä»£ç 
4. **æäº¤Issue** - åœ¨é¡¹ç›®ä»“åº“æäº¤é—®é¢˜

### è”ç³»æ–¹å¼

- é¡¹ç›®ä»“åº“: [GitHubé“¾æ¥]
- é—®é¢˜åé¦ˆ: [Issueé¡µé¢]
- æŠ€æœ¯æ”¯æŒ: [å¼€å‘è€…é‚®ç®±]

---

**ç‰ˆæœ¬**: 2.0.0  
**æ›´æ–°æ—¥æœŸ**: 2026å¹´2æœˆ9æ—¥  
**çŠ¶æ€**: âœ… ç¨³å®šå¯ç”¨

**å¼€å§‹ä½¿ç”¨å§ï¼ç¥ä½ å¼€å‘æ„‰å¿«ï¼** ğŸ‰


